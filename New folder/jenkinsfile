pipeline {
    agent any
    triggers {
        gitlab(
            triggerOnPush: true,
            triggerOnMergeRequest: true,
            branchFilterType: 'All',
            addVoteOnMergeRequest: true)
    }
    tools{
        maven 'maven'
        jdk 'JDK8'
    }
    stages {
        stage('pull') {
            steps {
                sh "git pull || git clone git@gitlab:edenavital/imageio.git ."
            }
        }
        stage('build') {
            steps {
                    configFileProvider(
                    [configFile(fileId: 'settings', variable: 'MAVEN_SETTINGS')])
                    {
                        sh "mvn versions:set -DnewVersion=$VERSION"
                        sh 'mvn -s $MAVEN_SETTINGS clean deploy'
                        
                    }
            }
        }


    }

}
